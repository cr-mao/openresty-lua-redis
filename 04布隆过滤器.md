

## redisbloom 环境搭建

先进入到redis5镜像 的容器中， 把 redisbloom.so 拷贝到 
/docker/redis5/200
/docker/redis5/201
/docker/redis5/202 
/docker/redis5/203
/docker/redis5/204 
/docker/redis5/205 中


```shell 
[root]# wget "https://github.com/RedisBloom/RedisBloom/archive/v2.2.0.tar.gz"
[root]# tar zxvf v2.2.0.tar.gz 
[root]# cd  RedisBloom-2.2.0/
[root]# make
[root]# ll
-rwxr-xr-x 1 root root 331600 Mar 16 20:15 redisbloom.so
``` 


修改 docker-composer 中的command

```shell 
/usr/local/bin/redis-server /redis/conf/redis.conf  --loadmodule /redis/redisbloom.so
```



#### redis使用 lua 
```shell 
local ok,err=red_c:eval([[
                 local key=KEYS[1]
                 local val=ARGV[1]
             --  local res,err=redis.call("bf.add",key,val)
                 local res,err=redis.call("bf.exists",key,val)
                 return res
  ]],1,'{bf_1}','test1')

```
1个 key,  {bf_1}  用括号扩起来  确定在哪个节点， test1代表val 


Redis集群当中使用hashTag让key分配在某个节点
 
Hash Tag 原理是

当一个 key 包含 {} 的时候，不对整个 key 做 hash，而仅对 {} 包括的字符串做 hash。 Hash Tag 可以让不同的 key 拥有相同的 hash 值，从
而分配在同一个槽里;这样针对不同 key 的批量操作(mget/mset 等)，以及事务、Lua 脚本等都可以支持。
