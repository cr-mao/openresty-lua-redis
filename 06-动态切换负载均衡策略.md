

## 负载均衡动态切换

利用consul 动态获得对应的策略


`curl -X PUT -d '1' http://127.0.0.1:8700/v1/kv/load` 

load = 1 => 某个upstream 

load = 2 => 某个upstream


可以用 后台监控脚本修改consul 中的load 值 即可 




#### 模板渲染

opm --install-dir=/usr/local/openresty/lualib/project/common get  bungle/lua-resty-template

./project/code/nginx/application/cache.lua



#### 缓存维度化拆分解决方案

面临难题：如何解决大value缓存的全量更新效率低下问题？

为什么需要维度化？

一般的业务场景，会对一些页面的数据全量打包为一个kv，比如说商品详情的页面，会把商品的基本信息，店家商铺信息，商品分类信息等这些信息组成的json
全部塞到一个kv中，然后，当我们对其中的某项数据进行修改的时候（比如说修改了商品的分类），需要把这个kv取出来，修改里面的数据，然后才是放到redis
中，很明显这样操作是对redis造成很大的性能影响的，每一次的小更新，都需要去操作这个比较大的kv值，对redis造成了一定的压力 就会出现以下问题
网络耗费的资源大，每次需要把整个缓存获取，修改，网络传输耗时为主要消耗
redis的性能和吞吐量能够支撑到多大，基本跟数据本身的大小有很大的关系

前端展示可以分为这么几个维度：商品维度(标题、图片、属性等)、 主商品维度（商品介绍、规格参数）、 分类维度、 商家维度、 店铺维度等； 另外还有一
些实时性要求比较高的如实时价格、实时促销、广告词、配送至、预售等是通过异步加载。